<?php if (!isset($_SESSION)) {
    session_start();
}
if (
    isset($_SESSION['admin']) and
    $_SESSION['admin'] == true
) {
    ?>
<!DOCTYPE html>
<html lang="en">

<head>
    <title>Digital Marketing Company | Web Design Company</title>
    <base href="../" />
    <?php include "includes/head.inc.php"; ?>
    <!-- <link rel="stylesheet" href="admin/css/categories.css" /> -->
    <style>
        table tr td i {
            visibility: hidden
        }

        table tr:hover td i {
            visibility: visible
        }

        .input-field .pos-abs {
            line-height: 42px;
            font-size: 16px;
        }

        .input-field #url,
        .input-field #eurl {
            padding-left: 169px;
            box-sizing: border-box;
        }
    </style>
</head>

<body>
    <!-- Page Layout here -->
    <section class="row m-0 p-0">
        <?php include "includes/sidenav.inc.html" ?>

        <div class="col s12 m9 white m-0 p-0" style="height:100vh;overflow:auto">
            <a class="p-2 pb-0 left" href="javascript:toggleNav()"><i class="material-icons text-primary">menu</i></a>
            <div class="px-4">
                <h4 class="my-1">Categories</h4>
            </div>
            <div class="border-top-1 grey-border border-lighten-2 mt-2"></div>
            <div class="grey lighten-3">
                <?php $sql = "SELECT * FROM `types`";
                    require "../services/db.inc.php";
                    include "includes/functions.inc.php";
                    date_default_timezone_set("Asia/Kolkata");
                    $conn =
                        DB::getConnection();
                    $result = $conn->query($sql); ?>

                <table>
                    <?php if ($result and ($num = $result->num_rows) > 0) {
                            ?>
                    <thead>
                        <tr>
                            <th class="pl-4">#</th>
                            <th>Title</th>
                            <th>URL</th>
                            <th>Description</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <?php for ($i = 0; $i <
                                    $num; $i++) {
                                    $cat = $result->fetch_assoc(); ?>
                        <tr>
                            <td class="pl-4">
                                <?= $i + 1 ?>
                            </td>
                            <td>
                                <?= $cat['title'] ?>
                            </td>
                            <td>
                                localhost/apsara/menu/<?=$cat['url'] ?>
                            </td>
                            <td>
                                <?= $cat['description'] ?>
                            </td>
                            <td>
                                <a class="transparent btn-flat circle btn-floating btn-medium tooltipped waves-effect waves-circle waves-dark"
                                    href="admin/products/<?=$cat['url']?>" data-tooltip="View"><i
                                        class="material-icons black-text lh-5">launch</i></a>
                                <button
                                    class="transparent btn-flat circle btn-floating btn-medium tooltipped waves-effect waves-circle waves-dark"
                                    onclick="editCategory(<?= $cat['_tid'] ?>, '<?= $cat['title'] ?>', '<?= $cat['url'] ?>', '<?= $cat['description'] ?>')"
                                    data-tooltip="Edit"><i class="material-icons black-text lh-5">edit</i></button>
                                <button
                                    class="transparent btn-flat circle btn-floating btn-medium tooltipped waves-effect waves-circle waves-dark"
                                    onclick="deleteCategory(<?= $cat['_tid'] ?>, this)" data-tooltip="Delete"><i
                                        class="material-icons black-text lh-5">delete</i></button>
                            </td>
                        </tr>
                    </tbody>
                    <?php
                            } ?>
                    <?php
                        } else {
                            ?>
                    <tr>
                        <td colspan="5" class="center-align">No categories found</td>
                    </tr>
                    <?php
                        } ?>
                </table>
            </div>
        </div>
    </section>
    <!-- Modal Structure -->
    <div id="categoryAdd" class="modal">
        <div class="progress-holder hide border-radius-0">
            <div class="progress border-radius-0">
                <div class="indeterminate bg-primary"></div>
            </div>
        </div>
        <div class="prevent-overlay hide full"></div>
        <div class="modal-content">
            <h4>Add new Category</h4>
            <br />
            <form>
                <div class="input-field">
                    <input id="title" type="text" class="validate" name="title" required minlength="3">
                    <label for="title">Title</label>
                </div>
                <div class="input-field">
                    <span class="pos-abs">localhost/apsara/menu/</span>
                    <input id="url" type="text" class="validate" name="url" minlength="3">
                </div>
                <div class="input-field">
                    <textarea id="description" class="materialize-textarea" name="desc"></textarea>
                    <label for="description">Description</label>
                    <span class="helper-text">Optional</span>
                </div>
                <button type="submit" class="right waves-effect waves-light bg-primary btn ml-1">Add</button>
                <button type="reset" class="right modal-close waves-effect waves-red btn-flat btn">Not now</button>
                <div class="clearfix"></div>
            </form>
        </div>
    </div>

    <!-- Modal Structure -->
    <div id="categoryEdit" class="modal">
        <div class="progress-holder hide border-radius-0">
            <div class="progress border-radius-0">
                <div class="indeterminate bg-primary"></div>
            </div>
        </div>
        <div class="prevent-overlay hide full"></div>
        <div class="modal-content">
            <h4>Edit Category</h4>
            <br />
            <form>
                <input id="e_tid" type="text" class="hide" name="tid">
                <div class="input-field">
                    <input id="etitle" type="text" class="validate" name="title" required minlength="3">
                    <label for="etitle">Title</label>
                </div>
                <div class="input-field">
                    <span class="pos-abs">localhost/apsara/menu/</span>
                    <input id="eurl" type="text" class="validate" name="url" required minlength="3">
                </div>
                <div class="input-field">
                    <textarea id="edescription" class="materialize-textarea" name="desc"></textarea>
                    <label for="edescription">Description</label>
                    <span class="helper-text">Optional</span>
                </div>
                <button type="submit" class="right waves-effect waves-light bg-primary btn ml-1">Update</button>
                <button type="reset" class="right modal-close waves-effect waves-red btn-flat btn">Not now</button>
                <div class="clearfix"></div>
            </form>
        </div>
    </div>


    <div class="fixed-action-btn">
        <a class="btn-floating btn-large bg-primary waves-effect waves-light modal-trigger" data-target="categoryAdd">
            <i class="large material-icons">add</i>
        </a>
    </div>


    <?php include "includes/scripts.inc.php"; ?>
    <script src="admin/js/categories.js"></script>
</body>

</html>

<?php
} else {
    header("Location: /admin/?redirect_to=" . $_SERVER['REDIRECT_URL']);
} ?>